// Code generated by cmd/cgo; DO NOT EDIT.

//line /Users/februarysnow/go/pkg/mod/github.com/99designs/go-keychain@v0.0.0-20191008050251-8e49817e8af4/datetime.go:1:1
// +build darwin ios

package keychain

/*
#cgo LDFLAGS: -framework CoreFoundation

#include <CoreFoundation/CoreFoundation.h>
*/
import _ "unsafe"
import (
	"math"
	"time"
)

const nsPerSec = 1000 * 1000 * 1000

// absoluteTimeIntervalSince1970() returns the number of seconds from
// the Unix epoch (1970-01-01T00:00:00+00:00) to the Core Foundation
// absolute reference date (2001-01-01T00:00:00+00:00). It should be
// exactly 978307200.
func absoluteTimeIntervalSince1970() int64 {
	return int64(( /*line :23:15*/*_Cvar_kCFAbsoluteTimeIntervalSince1970 /*line :23:48*/))
}

func unixToAbsoluteTime(s int64, ns int64)  /*line :26:44*/_Ctype_CFAbsoluteTime /*line :26:60*/ {
	// Subtract as int64s first before converting to floating
	// point to minimize precision loss (assuming the given time
	// isn't much earlier than the Core Foundation absolute
	// reference date).
	abs := s - absoluteTimeIntervalSince1970()
	return  /*line :32:9*/_Ctype_CFAbsoluteTime /*line :32:25*/(abs) +  /*line :32:33*/_Ctype_CFTimeInterval /*line :32:49*/(ns)/nsPerSec
}

func absoluteTimeToUnix(abs  /*line :35:29*/_Ctype_CFAbsoluteTime /*line :35:45*/) (int64, int64) {
	int, frac := math.Modf(float64(abs))
	return int64(int) + absoluteTimeIntervalSince1970(), int64(frac * nsPerSec)
}

// TimeToCFDate will convert the given time.Time to a CFDateRef, which
// must be released with Release(ref).
func TimeToCFDate(t time.Time)  /*line :42:32*/_Ctype_CFDateRef /*line :42:43*/ {
	s := t.Unix()
	ns := int64(t.Nanosecond())
	abs := unixToAbsoluteTime(s, ns)
	return func() _Ctype_CFDateRef{ var _cgo0 _Ctype_CFAllocatorRef = /*line :46:24*/*_Cvar_kCFAllocatorDefault /*line :46:45*/; var _cgo1 _Ctype_CFAbsoluteTime = /*line :46:47*/abs; return /*line :46:51*/_Cfunc_CFDateCreate(_cgo0, _cgo1); }()
}

// CFDateToTime will convert the given CFDateRef to a time.Time.
func CFDateToTime(d  /*line :50:21*/_Ctype_CFDateRef /*line :50:32*/) time.Time {
	abs := func() _Ctype_CFAbsoluteTime{ var _cgo0 _Ctype_CFDateRef = /*line :51:33*/d; return /*line :51:35*/_Cfunc_CFDateGetAbsoluteTime(_cgo0); }()
	s, ns := absoluteTimeToUnix(abs)
	return time.Unix(s, ns)
}

// Wrappers around C functions for testing.

func cfDateToAbsoluteTime(d  /*line :58:29*/_Ctype_CFDateRef /*line :58:40*/)  /*line :58:42*/_Ctype_CFAbsoluteTime /*line :58:58*/ {
	return func() _Ctype_CFAbsoluteTime{ var _cgo0 _Ctype_CFDateRef = /*line :59:33*/d; return /*line :59:35*/_Cfunc_CFDateGetAbsoluteTime(_cgo0); }()
}

func absoluteTimeToCFDate(abs  /*line :62:31*/_Ctype_CFAbsoluteTime /*line :62:47*/)  /*line :62:49*/_Ctype_CFDateRef /*line :62:60*/ {
	return func() _Ctype_CFDateRef{ var _cgo0 _Ctype_CFAllocatorRef = /*line :63:24*/*_Cvar_kCFAllocatorDefault /*line :63:45*/; var _cgo1 _Ctype_CFAbsoluteTime = /*line :63:47*/abs; return /*line :63:51*/_Cfunc_CFDateCreate(_cgo0, _cgo1); }()
}

func releaseCFDate(d  /*line :66:22*/_Ctype_CFDateRef /*line :66:33*/) {
	Release( /*line :67:10*/_Ctype_CFTypeRef /*line :67:21*/(d))
}
